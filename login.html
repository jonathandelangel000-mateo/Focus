<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus - Acceso</title>
    <style>
        :root { --acento: #00f2ff; --fondo: #0a0a0a; }
        body { background: var(--fondo); color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-card { background: #161616; padding: 30px; border-radius: 20px; text-align: center; width: 80%; max-width: 300px; border: 1px solid #333; }
        .avatar-upload { width: 80px; height: 80px; border-radius: 50%; background: #222; margin: 0 auto 15px; border: 2px dashed var(--acento); display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        .avatar-upload img { width: 100%; height: 100%; object-fit: cover; }
        input { width: 100%; background: #222; border: 1px solid #444; color: white; padding: 12px; margin: 10px 0; border-radius: 10px; text-align: center; font-size: 1rem; }
        .btn-entrar { background: var(--acento); color: black; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #file-input { display: none; }
    </style>
</head>
<body>

    <div class="login-card">
        <h2 id="saludo">Bienvenido</h2>
        
        <div class="avatar-upload" onclick="document.getElementById('file-input').click()">
            <img id="preview" src="" style="display:none;">
            <span id="placeholder-text" style="font-size: 0.7rem; color: #666;">Subir Foto</span>
        </div>
        <input type="file" id="file-input" accept="image/*" onchange="previsualizar(this)">

        <input type="text" id="username" placeholder="Tu Nombre">
        <input type="password" id="pin" placeholder="PIN de 4 dÃ­gitos" maxlength="4" inputmode="numeric">
        
        <button class="btn-entrar" onclick="procesarAcceso()">ENTRAR</button>
    </div>

    <script>
        const userSaved = JSON.parse(localStorage.getItem('focus_user'));

        if (userSaved) {
            document.getElementById('username').style.display = 'none';
            document.getElementById('placeholder-text').style.display = 'none';
            document.getElementById('preview').src = userSaved.photo;
            document.getElementById('preview').style.display = 'block';
            document.getElementById('saludo').innerText = "Hola, " + userSaved.name;
        }

        function previsualizar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('preview').src = e.target.result;
                    document.getElementById('preview').style.display = 'block';
                    document.getElementById('placeholder-text').style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function procesarAcceso() {
            const pinVal = document.getElementById('pin').value;
            const nameVal = document.getElementById('username').value;
            const photoVal = document.getElementById('preview').src;

            if (userSaved) {
                // Modo Login
                if (pinVal === userSaved.pin) {
                    sessionStorage.setItem('sesion_activa', 'true');
                    window.location.href = 'index.html';
                } else {
                    alert("PIN incorrecto");
                }
            } else {
                // Modo Registro
                if (nameVal && pinVal.length === 4 && photoVal) {
                    const newUser = { name: nameVal, pin: pinVal, photo: photoVal };
                    localStorage.setItem('focus_user', JSON.stringify(newUser));
                    sessionStorage.setItem('sesion_activa', 'true');
                    window.location.href = 'index.html';
                } else {
                    alert("Por favor completa nombre, PIN de 4 cifras y foto.");
                }
            }
        }
    </script>
</body>
</html>
